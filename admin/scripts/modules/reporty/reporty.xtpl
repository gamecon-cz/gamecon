<!-- begin: reporty -->

<h2>Univerz√°ln√≠ reporty</h2>

<form method="get" style="margin: 1em 0;">
    <input id="omniboxUzivateleFilterReportu" class="omnibox" type="text" name="userId" placeholder="Omezit data report≈Ø na jedin√©ho u≈æivatele..." style="min-width: 25em">
    <div class="tip">
        <label for="omniboxUzivateleFilterReportu">
            ‚Üë filtr report≈Ø podle u≈æivatele: napi≈° zaƒç√°tek p≈ôezd√≠vky, jm√©na, p≈ô√≠jmen√≠, emailu nebo ID
        </label>
    </div>
</form>

<style>
    #bfgr {
        margin: 1em 0;
        display: inline-block;
    }

    #bfgr .hint::after {
        content: " üßô";
    }
</style>

<table class="zvyraznovana">
  <tr>
    <th colspan="2">Report</th>
    <th colspan="2">Form√°ty</th>
  </tr>
  <tr>
    <td><a href="{baseUrl}/finance#bfgr">BFGR report</a></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <!-- begin: report -->
  <tr>
    <td>{nazev}</td>
    <td>
      <span class="hinted">i
        <span class="hint">
            posledn√≠ pou≈æit√≠ {jmeno_posledniho_uzivatele} {cas_posledniho_pouziti}<br>
            celkem pou≈æito {pocet_pouziti}‚úï
        </span>
      </span>
    </td>
    <td>{xlsx}</td>
    <td>{html}</td>
  </tr>
  <!-- end: report -->
</table>

<h2>
  Quick reporty
  <span class="hinted">‚Ñπ<span class="hint">tyto reporty samy n√°hodnƒõ miz√≠ a nelze tomu zabr√°nit. Proto nen√≠ mo≈æn√© na nƒõ spol√©hat</span></span>
</h2>

<table class="zvyraznovana">
  <tr>
    <th colspan="2">Report</th>
    <th colspan="2">Form√°ty</th>
    <th></th>
  </tr>
  <!-- begin: quick -->
  <tr>
    <td>{nazev}</td>
    <td>
      <span class="hinted">i
        <span class="hint">
            posledn√≠ pou≈æit√≠ {jmeno_posledniho_uzivatele} {cas_posledniho_pouziti}<br>
            celkem pou≈æito {pocet_pouziti}‚úï
        </span>
      </span>
    </td>
    <td>
      <!-- begin: xlsx -->
      <a href="reporty/quick?id={id}&format=xlsx" target="_blank">xlsx</a>
      <!-- end: xlsx -->
    </td>
    <td>
      <!-- begin: html -->
      <a href="reporty/quick?id={id}&format=html" target="_blank">html</a>
      <!-- end: html -->
    </td>
    <td><a href="reporty/quick-reporty?id={id}" class="tlacitko">upravit</a></td>
  </tr>
  <!-- end: quick -->
</table>

<script type="text/javascript">
(function() {
    // Initialize omnibox for user filtering
    var omnibox = document.getElementById('omniboxUzivateleFilterReportu');

    // Configure omnibox to use ajax-omnibox endpoint
    omnibox.setAttribute('data-omnibox-url', 'ajax-omnibox');

    // Listen for autocomplete select event
    jQuery(omnibox).on('autocompleteselect', function(event, ui) {
        var userId = ui.item.value;
        updateReportUrls(userId);
    });

    // Listen for input clear (when user deletes the text)
    jQuery(omnibox).on('input', function() {
          updateReportUrls(parseInt(this.value) || null);
    });

    function updateReportUrls(userId) {
        // Find all report links in the universal reports table
        var reportTable = document.querySelector('table.zvyraznovana');
        var links = reportTable.querySelectorAll('a[href*="reporty/"]');

        links.forEach(function(link) {
            var href = link.getAttribute('href');

            // Skip BFGR report link and quick-reporty edit links
            if (href.indexOf('finance#bfgr') !== -1 || href.indexOf('quick-reporty') !== -1) {
                return;
            }

            // Remove existing userId parameter if present
            href = href.replace(/[&?]userId=\d+/, '');

            // Add userId parameter if selected
            if (userId) {
                var separator = href.indexOf('?') === -1 ? '?' : '&';
                href = href + separator + 'userId=' + userId;
            }

            link.setAttribute('href', href);
        });
    }
})();
</script>

<!-- end: reporty -->
